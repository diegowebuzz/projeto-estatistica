<!DOCTYPE html>


<html>



    <head>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="Semantic-UI-CSS-master/semantic.min.css">
        <script  src="Semantic-UI-CSS-master/semantic.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    </head>

<body>
    <div class="ui grid">
        <div class="three wide column">
            <a href="index.html">
            <img class="ui image" src="data-now.png">
        </a>
        </div>
    </div>

    <div style="background-color:grey;">
        <div class="ui padded grid" style="background-image: url('bg.png');">

            <div class="five wide column"></div>
            <div class="six wide column grey">

                 <div class="item middle aligned content">
                <form >
               <label>Nome da Variável</label>
               <div>
                <div  class="ui input focus">
                    <input value="cores"  value="número carros" id="nomeVariavel"  > 
                </div>
            </div>

                <div class="p-3">
                    <label style="font-weight: bold;"> Entre com os dados separados por ponto e vírgula(;) </label>
                 <div>
                    <div class="ui input">
                        <input value="50;32;21;56;78;43;43"  id="dados" name="dados" placeholder="dado um; dado dois; dado um; dado três"
                            >
                    </div>
                </div>

                    <div>
                        <label style="font-weight: bold;">Tipo de variável</label>

                        <div>
                        <select id="tipoVariavel" name="tipoVariavel" class="ui dropdown">
                             <option value="">escolher</option>
                            <option  value="nominal">qualitativa nominal</option>
                            <option  value="ordinal">qualitativa ordinal</option>
                            <option selected value="discreta">quantitativa discreta</option>
                            <option  value="continua">quantitativa contínua</option>



                        </select>
                    </div>
                    </div>

                    <div class="text-center">
                        <label>amostra</label>
                        <input name="tipo" type="radio">

                        <label>população</label>
                        <input name="tipo" type="radio">
                    </div>

                    <div class="p-2">
                        <input type="file">
                    </div>

                    <button type="button" onclick="prepararCalcular()" class="ui button">calcular <i class="fa fa-bar-chart p-1"
                            aria-hidden="true"></i> </button>

                            <button type="button" onclick="limparCampos()" class="ui orange button">limpar campos <i class="fa fa-bar-chart p-1"
                                aria-hidden="true"></i> </button>
                </div>
            </form>
                </div>
            </div>

            <div class="five wide column"></div>



        </div>
    </div>

    <div id="resultado" class="ui padded grid" style="display: none;">

      <div class="seven wide column">
        <div id="tabela" >

            <table class="ui celled table">
                <thead>
                  <tr><th id="thNomeVariavel"></th>
                  <th>frequencia (fi)</th>
                  <th>frequencia(%)</th>
                  <th>frequencia(fac)</th>
                  <th>frequencia(fac%)</th>

                </tr></thead>
                <tbody id="tbody">
                
                
                </tbody>
              </table>

              <div>
                  <div class="ui small header"> 
                      medidas de tendência central
                  </div>
                  <div>
                   <div> <b>moda: </b>  <span id="moda"></span></div> 
                   <div> <b>média: </b>  <span id="media">não possui média</span></div> 
                   <div>  <b>mediana: </b>  <span id="mediana"></span></div> 


                  </div>
              </div>

    
        </div>
      </div>

      <div class="eight wide column">

        <div>

            <div class="ui large header" >Visualização Gráfica</div>
    
            <canvas  id="myChart"></canvas>
    
        
    
        </div>

      </div>



    </div>




  

    <script>

        var nomeVariavel = "";
        var tbody = $('#tbody');
        var dados  = "";
        var dadosParsados = [];
        var dadosUnicos = [];
        var dadosSplit = [];
        var arrSet = new Set();

       var limiteInferior;
      var freqAcumuladaAnterior = 0;
      var agrupamento;


var numeroElementos = 0;


        window.onload = function(){
            $('.ui.dropdown').dropdown();
        
       
};

       function prepararCalcular() { // faz preparações nos dados, caso seja necessário, antes de calcular


        tipoVariavel = $('#tipoVariavel').val();
        dados = $('#dados').val();

dadosSplit = dados.split(";");
dadosParsados = dadosSplit;
var set = new Set(dadosSplit);
         arrSet = Array.from(set);

         
for(var i = 0; i < arrSet.length; i++){
   
   $('#divOrdemOrdinais').append(`<div class='ui input'><input id="ordem_${i}"  placeholder='posição da variável ${arrSet[i]}'></div>`);
  
  
  }

       
         if(tipoVariavel == "ordinal"){

          $('.ui.modal').modal(   {onApprove : ordenarOrdinal }).modal('show');

                 

         }else{
          calcular();

         }


       }
    

      function calcular(){




            limparTabela();

           nomeVariavel = $('#nomeVariavel').val();

           if(tipoVariavel == "discreta"){
                  
                  gerarTabelaDiscreta();


           }
           if( tipoVariavel == "continua" ){

                gerarTabelaContinua();
                calcularMedianaQuantitativaContinua();


           }
           if(tipoVariavel == "ordinal" || tipoVariavel == "nominal"){

            var frequencia = Array();

$('#resultado').css("display", "block");

$('#thNomeVariavel').text(nomeVariavel);



 numeroElementos = dadosSplit.length;



var frequencia = Array();
 dadosUnicos = Array();

var tr

 for(var i = 0; i < dadosSplit.length; i++){
   
 if(dadosUnicos.includes(dadosSplit[i])){
 
    var valor =  $('#' + dadosSplit[i]).find("td:eq(1)").text();
      $('#' + dadosSplit[i]).find("td:eq(1)").text(parseInt(valor) + 1);


 }else{
     dadosUnicos.push(dadosSplit[i]); //verifica se o valor foi encontrado antes.
     $('#tbody').append("<tr " + "id='" + dadosSplit[i] + "'>"  + "<td>" + dadosSplit[i] + "</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>");

 }



 }

organizarDados();  

calcularPorcentagemFrequencia(dadosSplit);

calcularFrequenciaAcumulada(dadosUnicos);

construirGrafico(dadosUnicos);

//calcularModa(dadosUnicos);

//calcularMediana(dadosUnicos);

calcularModa(dadosUnicos)

if(tipoVariavel == 'continua' || tipoVariavel == 'discreta'){
    calcularMedia(dadosUnicos);

}


           }

   

     }

     function organizarDados(){

               

     }

     function  calcularPorcentagemFrequencia(dadosSplit){

        var fac = 0;


         for(var j = 0; j < dadosSplit.length; j++  )
         {

         var valor =  $('#' + dadosSplit[j]).find("td:eq(1)").text();

         var porcentagem = (parseInt(valor) * 100) / dadosSplit.length
        



        $('#' + dadosSplit[j]).find("td:eq(2)").text(porcentagem);
          
              

              
              
              }
            }

            function construirGrafico(dadosSplit){

                var nomesVariaveis = Array();
                var valoresVariaveis = Array();
                var labelsVariaveis = Array();
                var cores = Array();
                var valorCor = 40;

                for(var j = 0; j < dadosSplit.length; j++  )
         {

             valorCor += 40;
         var valor =  $('#' + dadosSplit[j]).find("td:eq(0)").text();
         var valorValor = $('#' + dadosSplit[j]).find("td:eq(1)").text();
         var labelVariavel = $('#' + dadosSplit[j]).find("td:eq(0)").text();
              nomesVariaveis.push(valor);
              valoresVariaveis.push(valorValor);
              labelsVariaveis.push(labelVariavel);
              cores.push('rgb(' + '255' + ', '  + valorCor +   ', 132)');


              
              }

                       
              var ctx = document.getElementById('myChart').getContext('2d');
              var mixedChart = new Chart(ctx, {
    type: 'bar',
    data: {
        datasets: [{
            label: 'Bar Dataset',
            data: valoresVariaveis
        }],
        labels: labelsVariaveis,
        backgroundColor: ["red", "blue", "green"], 

        borderColor:cores

    },

     options: {
    scales: {
        yAxes: [{
            ticks: {
                beginAtZero: true
            }
        }]
    }
}
});

  
            }

            var moda = "";


   


            function procurarModa(maiorValor, dadosSplit){

                for(var j = 0; j < dadosSplit.length; j++  )
         {

                var fi =  $('#' + dadosSplit[j]).find("td:eq(1)").text();
         
               if(parseInt(fi) == maiorValor ){

                  moda += " " +    $('#' + dadosSplit[j]).find("td:eq(0)").text();

               }

              
              }
                

            }

           function calcularMedia(dadosUnicos){

             var tipoVariavel = $('#tipoVariavel').val();

             if(tipoVariavel == "ordinal" || tipoVariavel == "nominal"){

                  $('#media').text("não possui média")

             }
             
             if(tipoVariavel == "contínua")
             {

             }
             else{


                var soma = 0;;

                for(var j = 0; j < dadosUnicos.length; j++  )
         {


                 soma +=  parseInt($('#' + dadosUnicos[j]).find("td:eq(1)").text()) *  parseInt($('#' + dadosUnicos[j]).find("td:eq(0)").text());
                  
                      
              
              }

                        $('#media').text(soma / numeroElementos);


             }

               
             


            }

            function calcularMediana(dadosUnicos){

               var mediana = "";
               
                   var par = (numeroElementos % 2 == 0); //verifica se o número de elementos é par

                   if(par){  //se for par pego as duas posições centrais, se for impar pego só o único elemento central

                    var posicao1 = numeroElementos / 2;  
                    var posicao2 = posicao1 + 1;

                    for(var j = 0; j < dadosUnicos.length; j++  )
         {
 
            if( tipoVariavel == "discreta")
          {
                var fac =  parseInt($('#' + dadosUnicos[j]).find("td:eq(3)").text());
         
                      if(!(posicao1 > fac || posicao1 < fac )){
                        
                        $('#mediana').text($('#' + dadosUnicos[j]).find("td:eq(0)").text());


                         if( parseInt($('#' + dadosUnicos[j]).find("td:eq(3)").text()) == posicao1 ){
                            $('#mediana').append( " " + $('#' + dadosUnicos[j + 1]).find("td:eq(0)").text());

                         }

                      }
          }else{

            $('#mediana').text( dadosParsados[ ((dadosParsados.length ) / 2) - 1  ] + " " +  dadosParsados[ ((dadosParsados.length ) / 2)  ]);

          }
              
              }

                     
                   }else{
                    if(tipoVariavel == "continua" || tipoVariavel == "discreta")
              {

                       var posicao = numeroElementos / 2;  
                       var valorCentral = Math.ceil(posicao);

                       for(var j = 0; j < dadosUnicos.length; j++  )
         {

                var fac =  parseInt($('#' + dadosUnicos[j]).find("td:eq(3)").text());
         
                      if(!(valorCentral > fac || valorCentral < fac )){

                        $('#mediana').text($('#' + dadosUnicos[j]).find("td:eq(0)").text());


                      }   
              
              }
              }else{
                  
                $('#mediana').text($('#' +  dadosParsados[ (dadosParsados.length - 1) / 2  ]).find("td:eq(0)").text());


              }


                   }




            }


            function calcularFrequenciaAcumulada(dadosSplit){

              
                for(var j = 0; j < dadosSplit.length; j++  )
         {

    
          
              
           if(j != 0){

            var facAnterior  = parseInt( $('#' + dadosSplit[j - 1]).find("td:eq(3)").text());
            var facAtual  = parseInt( $('#' + dadosSplit[j]).find("td:eq(1)").text());

            var facPorAnterior  = parseFloat( $('#' + dadosSplit[j - 1]).find("td:eq(4)").text());
            var facPorAtual  = parseFloat( $('#' + dadosSplit[j]).find("td:eq(2)").text());

               
                    $('#' + dadosSplit[j]).find("td:eq(3)").text( facAnterior + facAtual  );
                    $('#' + dadosSplit[j]).find("td:eq(4)").text( facPorAtual + facPorAnterior  );

           }  else{
               //na primeira vez, a frequencia acumulada é o valor da frequencia simples
            $('#' + dadosSplit[j]).find("td:eq(3)").text( $('#' + dadosSplit[j]).find("td:eq(1)").text( ));
            $('#' + dadosSplit[j]).find("td:eq(4)").text( $('#' + dadosSplit[j]).find("td:eq(2)").text( ));

           }

              
              
              }

        }

        function gerarTabelaDiscreta(){

 
            var frequencia = Array();

$('#resultado').css("display", "block");

$('#thNomeVariavel').text(nomeVariavel);

 var dados = $('#dados').val();

var dadosSplit = dados.split`;`.map(x=>+x).sort();

console.log(dadosSplit);

 numeroElementos = dadosSplit.length;



var frequencia = Array();
var dadosUnicos = Array();

var tr

 for(var i = 0; i < dadosSplit.length; i++){
   
 if(dadosUnicos.includes(dadosSplit[i])){
 
    var valor =  $('#' + dadosSplit[i]).find("td:eq(1)").text();
      $('#' + dadosSplit[i]).find("td:eq(1)").text(parseInt(valor) + 1);


 }else{
     dadosUnicos.push(dadosSplit[i]); //verifica se o valor foi encontrado antes.
     $('#tbody').append("<tr " + "id='" + dadosSplit[i] + "'>"  + "<td>" + dadosSplit[i] + "</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>");

 }





 }

 organizarDados();  

calcularPorcentagemFrequencia(dadosSplit);

calcularFrequenciaAcumulada(dadosUnicos);

construirGrafico(dadosUnicos);

calcularModa(dadosUnicos);


calcularMedia(dadosUnicos);
calcularMediana(dadosUnicos);
            

        }


        function gerarTabelaContinua(){
             
            var frequencia = Array();
            var amplitude = 0;
            var numeroClasses = 0;
            var intervaloClasses = 0;
            var media = 0;


$('#resultado').css("display", "block");

$('#thNomeVariavel').text(nomeVariavel);

 var dados = $('#dados').val();

var dadosSplit = dados.split`;`.map(x=>+x).sort(function(a, b) {
  return a - b;
});
  //divide os dados por ";" e organiza em ordem crescente

console.log(dadosSplit);

amplitude = dadosSplit[dadosSplit.length - 1] - dadosSplit[0];
numeroClasses =   Math.floor( Math.sqrt(dadosSplit.length));
intervaloClasses = Math.floor( amplitude / numeroClasses);

agrupamento = intervaloClasses;

 numeroElementos = dadosSplit.length;



var frequencia = Array();
var dadosUnicos = Array();

var tr

 var inicial  = dadosSplit[0];
//imprime as informações do intervalo na tabela
 for(var i = 0; i <= numeroClasses; i++){
   
    var elemetosIntervalo = Array();


     for(var j = 0; j < dadosSplit.length; j++){
       
       

        if((dadosSplit[j] >= inicial) && (dadosSplit[j] < (inicial + intervaloClasses)) )
        {
        elemetosIntervalo.push(dadosSplit[j]);
        }
    
     }
     

     dadosUnicos.push(inicial); //verifica se o valor foi encontrado antes.
     $('#tbody').append("<tr " + "id='" + inicial + "'>"  + "<td>" +  inicial + "|--" + ( inicial + intervaloClasses) + "</td><td>" + elemetosIntervalo.length  + "</td><td>1</td><td>1</td><td>1</td></tr>");

 
     inicial += intervaloClasses;



             
        }

          var valorInicialMaiorFrequencia = -1;
          var maiorFrequencia = -1;

          for(var x = 0; x < dadosUnicos.length; x++){
 

              media += ((dadosUnicos[x] + dadosUnicos[x] + intervaloClasses) / 2) * parseInt( $('#' + dadosUnicos[x]).find("td:eq(1)").text()) ;
              
              if(parseInt( $('#' + dadosUnicos[x]).find("td:eq(1)").text()) > maiorFrequencia ){

                  maiorFrequencia = parseInt( $('#' + dadosUnicos[x]).find("td:eq(1)").text()) ;
                valorInicialMaiorFrequencia = dadosUnicos[x];
              }

          }


          media = media / dadosSplit.length;


           $('#media').text(media);
           $('#moda').text( (valorInicialMaiorFrequencia + valorInicialMaiorFrequencia + intervaloClasses) / 2  );
           organizarDados();  

calcularPorcentagemFrequencia(dadosSplit);

calcularFrequenciaAcumulada(dadosUnicos);

construirGrafico(dadosUnicos);


        }


      function limparCampos(){

          $('#dados').val("");
          $('#nomeVariavel').val("");
          $('#tipoVariavel').val("");
          $('.ui.dropdown').dropdown('clear');

      }

      function limparTabela(){

         $('tbody').empty();
         $('#media').text("não possui média");
         $('#mediana').text("");
         $('#moda').text("");



      }

      function recuperarOrdem(){

          

      }

      function ordenarOrdinal(){

        var tabelaOrdenacao = [];
        var novoDados = "";


           for(var i = 0; i < arrSet.length; i++ ){


               tabelaOrdenacao[i] =  parseInt( $('#ordem_' + i).val()) ;
               
           }

           for(var i = 0; i < tabelaOrdenacao.length; i++ ){


              var index = (tabelaOrdenacao.indexOf( i + 1))
              

               var reg = new RegExp(arrSet[index] + ";?", "g");
              var numVezes =  (dados.match(reg || []).length); // conta quantas vezes a variável aparece na entrada do usuário

               for(m = 0; m < numVezes; m++){
                 
                novoDados += arrSet[index] + ";"

               }

               if((i + 1) == tabelaOrdenacao.length){
                  novoDados = novoDados.slice(0, -1) ; //tira o ultimo ponto e vírgula (;)
               }

          }

          dados = novoDados;
          dadosSplit = dados.split(";");
          dadosParsados = dadosSplit;
         
         calcular();
           
           
      }


      function calcularModa(dadosUnicos){ //itero as linhas da tabela para checar as frequencias de maior valor


  
  var possuiModa = false;
 var valorAnterior =  parseInt($('#' + dadosUnicos[0]).find("td:eq(1)").text()); //valor da primeira frequência
 var maiorValor = parseInt(valorAnterior); //armazena a maior frequência até o momento


  for(var j = 1; j < dadosUnicos.length; j++  )
{

 var fi = parseInt($('#' +  dadosUnicos[j]).find("td:eq(1)").text()); //coluna das frequencias (fi)

   if(fi != valorAnterior){//se pelo menos uma fez há frequencias com valores diferentes, significa que tem moda

       possuiModa = true;
   }
  
   
   
   valorAnterior = parseInt($('#' +  dadosUnicos[j - 1]).find("td:eq(1)").text());


   if(fi> maiorValor){
       maiorValor = fi;
   }

}

procurarModa(maiorValor, dadosUnicos);


if(possuiModa)
{
  $("#moda").text( moda);


}
else{

  $("#moda").text("não possui moda");


}

}


  function calcularMedianaQuantitativaContinua(){
     


       // limiteInferior;
     // var somatorioFI = dadosSplit.length / 2;
      // freqAcumuladaAnterior = 0;

     // var resultado = limiteInferior + ( (somatorioFI - freqAcumuladaAnterior) / freqAcumuladaAnterior ) * agrupamento;
             
          // $('#mediana').text(resultado);

 }


    </script>

   
<div class="ui modal">
    <div class="header">Você escolheu uma variável qualitativa nominal, especifique a ordem</div>
    <div class="content">
      <div id="divOrdemOrdinais">

      </div>
    </div>
    <div class="actions">
      <div  class="ui approve positive button">Confirmar Ordem</div>
      
    </div>
  </div>

</body>

</html>